import { createDataViewPacketParser } from 'msg-fabric-packet-stream';

function browser_router_plugin(plugin_options = {}) {
  return { order: -2, subclass(FabricHub_PI, bases) {
      Object.assign(FabricHub_PI.prototype, {
        packetParser: createDataViewPacketParser(plugin_options),

        _init_router() {
          const id_self = random_id_self();
          const router = new bases.Router(id_self);
          router.allowUnverifiedRoutes = true;
          return router;
        } });
    } };
}

function random_id_self() {
  const ua = new Int32Array(1),
        dv = new DataView(ua.buffer);
  if ('undefined' !== typeof window) {
    window.crypto.getRandomValues(ua);
  } else {
    ua[0] = 0xffffffff * Math.random();
  }
  return dv.getInt32(0, true);
}

export default browser_router_plugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2luLXJvdXRlci1icm93c2VyLm1qcyIsInNvdXJjZXMiOlsiLi4vY29kZS9wbHVnaW5zL3JvdXRlci9icm93c2VyLmpzeSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2NyZWF0ZURhdGFWaWV3UGFja2V0UGFyc2VyIGFzIGNyZWF0ZVBhY2tldFBhcnNlcn0gZnJvbSAnbXNnLWZhYnJpYy1wYWNrZXQtc3RyZWFtJ1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBicm93c2VyX3JvdXRlcl9wbHVnaW4ocGx1Z2luX29wdGlvbnM9e30pIDo6XG4gIHJldHVybiBAOiBvcmRlcjogLTIsIHN1YmNsYXNzKEZhYnJpY0h1Yl9QSSwgYmFzZXMpIDo6XG4gICAgT2JqZWN0LmFzc2lnbiBAIEZhYnJpY0h1Yl9QSS5wcm90b3R5cGUsIEA6XG4gICAgICBwYWNrZXRQYXJzZXI6IGNyZWF0ZVBhY2tldFBhcnNlciBAIHBsdWdpbl9vcHRpb25zXG5cbiAgICAgIF9pbml0X3JvdXRlcigpIDo6XG4gICAgICAgIGNvbnN0IGlkX3NlbGYgPSByYW5kb21faWRfc2VsZigpXG4gICAgICAgIGNvbnN0IHJvdXRlciA9IG5ldyBiYXNlcy5Sb3V0ZXIoaWRfc2VsZilcbiAgICAgICAgcm91dGVyLmFsbG93VW52ZXJpZmllZFJvdXRlcyA9IHRydWVcbiAgICAgICAgcmV0dXJuIHJvdXRlclxuXG5mdW5jdGlvbiByYW5kb21faWRfc2VsZigpIDo6XG4gIGNvbnN0IHVhID0gbmV3IEludDMyQXJyYXkoMSksIGR2ID0gbmV3IERhdGFWaWV3KHVhLmJ1ZmZlcilcbiAgaWYgJ3VuZGVmaW5lZCcgIT09IHR5cGVvZiB3aW5kb3cgOjpcbiAgICB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcyh1YSlcbiAgZWxzZSA6OlxuICAgIHVhWzBdID0gMHhmZmZmZmZmZiAqIE1hdGgucmFuZG9tKClcbiAgcmV0dXJuIGR2LmdldEludDMyKDAsIHRydWUpXG4iXSwibmFtZXMiOlsiYnJvd3Nlcl9yb3V0ZXJfcGx1Z2luIiwicGx1Z2luX29wdGlvbnMiLCJvcmRlciIsInN1YmNsYXNzIiwiRmFicmljSHViX1BJIiwiYmFzZXMiLCJhc3NpZ24iLCJwcm90b3R5cGUiLCJjcmVhdGVQYWNrZXRQYXJzZXIiLCJpZF9zZWxmIiwicmFuZG9tX2lkX3NlbGYiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJhbGxvd1VudmVyaWZpZWRSb3V0ZXMiLCJ1YSIsIkludDMyQXJyYXkiLCJkdiIsIkRhdGFWaWV3IiwiYnVmZmVyIiwid2luZG93IiwiY3J5cHRvIiwiZ2V0UmFuZG9tVmFsdWVzIiwiTWF0aCIsInJhbmRvbSIsImdldEludDMyIl0sIm1hcHBpbmdzIjoiOztBQUVlLFNBQVNBLHFCQUFULENBQStCQyxpQkFBZSxFQUE5QyxFQUFrRDtTQUN0RCxFQUFDQyxPQUFPLENBQUMsQ0FBVCxFQUFZQyxTQUFTQyxZQUFULEVBQXVCQyxLQUF2QixFQUE4QjthQUMxQ0MsTUFBUCxDQUFnQkYsYUFBYUcsU0FBN0IsRUFBMEM7c0JBQzFCQywyQkFBcUJQLGNBQXJCLENBRDBCOzt1QkFHekI7Z0JBQ1BRLFVBQVVDLGdCQUFoQjtnQkFDTUMsU0FBUyxJQUFJTixNQUFNTyxNQUFWLENBQWlCSCxPQUFqQixDQUFmO2lCQUNPSSxxQkFBUCxHQUErQixJQUEvQjtpQkFDT0YsTUFBUDtTQVBzQyxFQUExQztLQURPLEVBQVQ7OztBQVVGLFNBQVNELGNBQVQsR0FBMEI7UUFDbEJJLEtBQUssSUFBSUMsVUFBSixDQUFlLENBQWYsQ0FBWDtRQUE4QkMsS0FBSyxJQUFJQyxRQUFKLENBQWFILEdBQUdJLE1BQWhCLENBQW5DO01BQ0csZ0JBQWdCLE9BQU9DLE1BQTFCLEVBQW1DO1dBQzFCQyxNQUFQLENBQWNDLGVBQWQsQ0FBOEJQLEVBQTlCO0dBREYsTUFFSztPQUNBLENBQUgsSUFBUSxhQUFhUSxLQUFLQyxNQUFMLEVBQXJCOztTQUNLUCxHQUFHUSxRQUFILENBQVksQ0FBWixFQUFlLElBQWYsQ0FBUDs7Ozs7In0=
