import { URL } from 'url';
import { randomBytes } from 'crypto';
import { createBufferPacketParser } from 'msg-fabric-packet-stream';

function nodejs_router_plugin(plugin_options = {}) {
  return { subclass(FiberHub_PI, bases) {
      Object.assign(FiberHub_PI.prototype, {
        packetParser: createBufferPacketParser(plugin_options),

        _parseConnectURL(conn_url) {
          return new URL(conn_url);
        },

        _init_router() {
          const id_self = random_id_self();
          const router = new bases.Router(id_self);
          router.allowUnverifiedRoutes = true;
          return router;
        } });
    } };
}

function random_id_self() {
  return randomBytes(4).readInt32LE();
}

export default nodejs_router_plugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2luLXJvdXRlci1ub2RlLm1qcyIsInNvdXJjZXMiOlsiLi4vY29kZS9wbHVnaW5zL3JvdXRlci9ub2RlLmpzeSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1VSTH0gZnJvbSAndXJsJ1xuaW1wb3J0IHtyYW5kb21CeXRlc30gZnJvbSAnY3J5cHRvJ1xuaW1wb3J0IHtjcmVhdGVCdWZmZXJQYWNrZXRQYXJzZXIgYXMgY3JlYXRlUGFja2V0UGFyc2VyfSBmcm9tICdtc2ctZmFicmljLXBhY2tldC1zdHJlYW0nXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG5vZGVqc19yb3V0ZXJfcGx1Z2luKHBsdWdpbl9vcHRpb25zPXt9KSA6OlxuICByZXR1cm4gQDogc3ViY2xhc3MoRmliZXJIdWJfUEksIGJhc2VzKSA6OlxuICAgIE9iamVjdC5hc3NpZ24gQCBGaWJlckh1Yl9QSS5wcm90b3R5cGUsIEA6XG4gICAgICBwYWNrZXRQYXJzZXI6IGNyZWF0ZVBhY2tldFBhcnNlciBAIHBsdWdpbl9vcHRpb25zXG5cbiAgICAgIF9wYXJzZUNvbm5lY3RVUkwoY29ubl91cmwpIDo6XG4gICAgICAgIHJldHVybiBuZXcgVVJMKGNvbm5fdXJsKVxuXG4gICAgICBfaW5pdF9yb3V0ZXIoKSA6OlxuICAgICAgICBjb25zdCBpZF9zZWxmID0gcmFuZG9tX2lkX3NlbGYoKVxuICAgICAgICBjb25zdCByb3V0ZXIgPSBuZXcgYmFzZXMuUm91dGVyKGlkX3NlbGYpXG4gICAgICAgIHJvdXRlci5hbGxvd1VudmVyaWZpZWRSb3V0ZXMgPSB0cnVlXG4gICAgICAgIHJldHVybiByb3V0ZXJcblxuZnVuY3Rpb24gcmFuZG9tX2lkX3NlbGYoKSA6OlxuICByZXR1cm4gcmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKVxuIl0sIm5hbWVzIjpbIm5vZGVqc19yb3V0ZXJfcGx1Z2luIiwicGx1Z2luX29wdGlvbnMiLCJzdWJjbGFzcyIsIkZpYmVySHViX1BJIiwiYmFzZXMiLCJhc3NpZ24iLCJwcm90b3R5cGUiLCJjcmVhdGVQYWNrZXRQYXJzZXIiLCJjb25uX3VybCIsIlVSTCIsImlkX3NlbGYiLCJyYW5kb21faWRfc2VsZiIsInJvdXRlciIsIlJvdXRlciIsImFsbG93VW52ZXJpZmllZFJvdXRlcyIsInJhbmRvbUJ5dGVzIiwicmVhZEludDMyTEUiXSwibWFwcGluZ3MiOiI7Ozs7QUFJZSxTQUFTQSxvQkFBVCxDQUE4QkMsaUJBQWUsRUFBN0MsRUFBaUQ7U0FDckQsRUFBQ0MsU0FBU0MsV0FBVCxFQUFzQkMsS0FBdEIsRUFBNkI7YUFDOUJDLE1BQVAsQ0FBZ0JGLFlBQVlHLFNBQTVCLEVBQXlDO3NCQUN6QkMseUJBQXFCTixjQUFyQixDQUR5Qjs7eUJBR3RCTyxRQUFqQixFQUEyQjtpQkFDbEIsSUFBSUMsR0FBSixDQUFRRCxRQUFSLENBQVA7U0FKcUM7O3VCQU14QjtnQkFDUEUsVUFBVUMsZ0JBQWhCO2dCQUNNQyxTQUFTLElBQUlSLE1BQU1TLE1BQVYsQ0FBaUJILE9BQWpCLENBQWY7aUJBQ09JLHFCQUFQLEdBQStCLElBQS9CO2lCQUNPRixNQUFQO1NBVnFDLEVBQXpDO0tBRE8sRUFBVDs7O0FBYUYsU0FBU0QsY0FBVCxHQUEwQjtTQUNqQkksWUFBWSxDQUFaLEVBQWVDLFdBQWYsRUFBUDs7Ozs7In0=
