import { URL } from 'url';
import { randomBytes } from 'crypto';
import { createBufferPacketParser } from 'msg-fabric-packet-stream';

function nodejs_router_plugin(plugin_options = {}) {
  return { order: -2, subclass(FabricHub_PI, bases) {
      Object.assign(FabricHub_PI.prototype, {
        packetParser: createBufferPacketParser(plugin_options),

        _parseConnectURL(conn_url) {
          return new URL(conn_url);
        },

        _init_router() {
          const id_self = random_id_self();
          const router = new bases.Router(id_self);
          router.allowUnverifiedRoutes = true;
          return router;
        } });
    } };
}

function random_id_self() {
  return randomBytes(4).readInt32LE();
}

export default nodejs_router_plugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2luLXJvdXRlci1ub2RlLm1qcyIsInNvdXJjZXMiOlsiLi4vY29kZS9wbHVnaW5zL3JvdXRlci9ub2RlLmpzeSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1VSTH0gZnJvbSAndXJsJ1xuaW1wb3J0IHtyYW5kb21CeXRlc30gZnJvbSAnY3J5cHRvJ1xuaW1wb3J0IHtjcmVhdGVCdWZmZXJQYWNrZXRQYXJzZXIgYXMgY3JlYXRlUGFja2V0UGFyc2VyfSBmcm9tICdtc2ctZmFicmljLXBhY2tldC1zdHJlYW0nXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG5vZGVqc19yb3V0ZXJfcGx1Z2luKHBsdWdpbl9vcHRpb25zPXt9KSA6OlxuICByZXR1cm4gQDogb3JkZXI6IC0yLCBzdWJjbGFzcyhGYWJyaWNIdWJfUEksIGJhc2VzKSA6OlxuICAgIE9iamVjdC5hc3NpZ24gQCBGYWJyaWNIdWJfUEkucHJvdG90eXBlLCBAOlxuICAgICAgcGFja2V0UGFyc2VyOiBjcmVhdGVQYWNrZXRQYXJzZXIgQCBwbHVnaW5fb3B0aW9uc1xuXG4gICAgICBfcGFyc2VDb25uZWN0VVJMKGNvbm5fdXJsKSA6OlxuICAgICAgICByZXR1cm4gbmV3IFVSTChjb25uX3VybClcblxuICAgICAgX2luaXRfcm91dGVyKCkgOjpcbiAgICAgICAgY29uc3QgaWRfc2VsZiA9IHJhbmRvbV9pZF9zZWxmKClcbiAgICAgICAgY29uc3Qgcm91dGVyID0gbmV3IGJhc2VzLlJvdXRlcihpZF9zZWxmKVxuICAgICAgICByb3V0ZXIuYWxsb3dVbnZlcmlmaWVkUm91dGVzID0gdHJ1ZVxuICAgICAgICByZXR1cm4gcm91dGVyXG5cbmZ1bmN0aW9uIHJhbmRvbV9pZF9zZWxmKCkgOjpcbiAgcmV0dXJuIHJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKClcbiJdLCJuYW1lcyI6WyJub2RlanNfcm91dGVyX3BsdWdpbiIsInBsdWdpbl9vcHRpb25zIiwib3JkZXIiLCJzdWJjbGFzcyIsIkZhYnJpY0h1Yl9QSSIsImJhc2VzIiwiYXNzaWduIiwicHJvdG90eXBlIiwiY3JlYXRlUGFja2V0UGFyc2VyIiwiY29ubl91cmwiLCJVUkwiLCJpZF9zZWxmIiwicmFuZG9tX2lkX3NlbGYiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJhbGxvd1VudmVyaWZpZWRSb3V0ZXMiLCJyYW5kb21CeXRlcyIsInJlYWRJbnQzMkxFIl0sIm1hcHBpbmdzIjoiOzs7O0FBSWUsU0FBU0Esb0JBQVQsQ0FBOEJDLGlCQUFlLEVBQTdDLEVBQWlEO1NBQ3JELEVBQUNDLE9BQU8sQ0FBQyxDQUFULEVBQVlDLFNBQVNDLFlBQVQsRUFBdUJDLEtBQXZCLEVBQThCO2FBQzFDQyxNQUFQLENBQWdCRixhQUFhRyxTQUE3QixFQUEwQztzQkFDMUJDLHlCQUFxQlAsY0FBckIsQ0FEMEI7O3lCQUd2QlEsUUFBakIsRUFBMkI7aUJBQ2xCLElBQUlDLEdBQUosQ0FBUUQsUUFBUixDQUFQO1NBSnNDOzt1QkFNekI7Z0JBQ1BFLFVBQVVDLGdCQUFoQjtnQkFDTUMsU0FBUyxJQUFJUixNQUFNUyxNQUFWLENBQWlCSCxPQUFqQixDQUFmO2lCQUNPSSxxQkFBUCxHQUErQixJQUEvQjtpQkFDT0YsTUFBUDtTQVZzQyxFQUExQztLQURPLEVBQVQ7OztBQWFGLFNBQVNELGNBQVQsR0FBMEI7U0FDakJJLFlBQVksQ0FBWixFQUFlQyxXQUFmLEVBQVA7Ozs7OyJ9
