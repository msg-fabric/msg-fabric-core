import {inspect} from 'util'
import {TestDirectHub as Hub} from './_setup.jsy'

const hub = Hub.create('hub')
const {id_route} = hub.local
const apple = @{} id_route, id_target: 'apple'

::
  const {_recv_} = hub.msgs.as(apple)
  hub.local.registerTarget @ apple.id_target, pkt => ::
    const rpkt = _recv_(pkt)
    if null == rpkt :: 
      console.log @ 'Part:', pkt, inspect(pkt.op, {colors:true})

    else if rpkt.is_pkt ::
      console.log @ 'Pkt:', pkt, inspect(pkt.op, {colors:true})
      console.log()

    else if rpkt.is_multi_pkt ::
      console.log @ 'MultiPkt:', rpkt, inspect(rpkt.op, {colors:true})
      console.log()

const msg_apple = hub.msgs.to @: id_route, id_target: 'apple'

const line = '0123456789abcde '.repeat(16)
msg_apple.send @ Array(128).fill(line)
msg_apple.send @ Array(256).fill(line)
msg_apple.send @ Array(384).fill(line)
msg_apple.send @ Array(512).fill(line)
msg_apple.send @ Array(768).fill(line)
msg_apple.send @ Array(1024).fill(line)

